<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flip Analysis Pro | Bernard Consulting Services</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Open+Sans:wght@300;400;600&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

    <style>
        :root {
            --brand-blue: #0a2540;
            --brand-green: #00d1b2;
            --light-bg: #f6f9fc;
            --text-main: #424770;
            --white: #ffffff;
            --border-color: #e1e4e8;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Open Sans', sans-serif; color: var(--text-main); line-height: 1.6; background: var(--light-bg); }
        h1, h2, h3 { font-family: 'Montserrat', sans-serif; color: var(--brand-blue); }

        nav { background: var(--white); padding: 1.2rem 10%; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .logo { font-weight: 700; font-size: 1.1rem; color: var(--brand-blue); text-decoration: none; text-transform: uppercase; letter-spacing: 1px; }
        .page-header { background: var(--brand-blue); color: var(--white); padding: 40px 10%; text-align: center; }

        .container-narrow { max-width: 700px; margin: -30px auto 60px; }
        .calc-card { background: var(--white); padding: 40px; border-radius: 12px; box-shadow: 0 20px 40px rgba(0,0,0,0.1); }

        .input-group { display: flex; flex-direction: column; margin-bottom: 15px; }
        label { font-size: 0.7rem; font-weight: 700; margin-bottom: 2px; color: var(--brand-blue); text-transform: uppercase; }
        .desc { font-size: 0.7rem; color: #666; margin-bottom: 5px; }
        input { padding: 10px; border: 1px solid var(--border-color); border-radius: 6px; font-size: 1rem; color: var(--brand-blue); background: #fcfcfc; }
        
        .section-label { border-bottom: 2px solid var(--brand-green); margin: 25px 0 15px; padding-bottom: 5px; font-size: 0.8rem; font-weight: 700; color: var(--brand-blue); text-transform: uppercase; }

        .btn-container { display: flex; gap: 10px; margin-top: 25px; }
        .analyze-btn { flex: 2; padding: 18px; background: var(--brand-green); color: var(--brand-blue); border: none; border-radius: 6px; font-weight: 700; cursor: pointer; }
        .pdf-btn { flex: 1; padding: 18px; background: var(--brand-blue); color: var(--white); border: none; border-radius: 6px; font-weight: 600; cursor: pointer; display: none; }
        
        #result { margin-top: 30px; padding: 25px; border-radius: 8px; background: #f8fafc; border: 1px solid var(--border-color); display: none; }
        .stat-line { display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 0.95rem; border-bottom: 1px solid #edf2f7; padding-bottom: 5px; color: #0a2540; }
        .profit-text { font-size: 1.5rem; font-weight: 700; text-align: center; margin-top: 15px; display: block; }
        .green { color: #2d6a4f; }
        .red { color: #a61e1e; }

        /* PDF HIDDEN AREA - Force block display, move off-screen */
        #pdf-export-element {
            position: absolute;
            left: -5000px;
            top: 0;
            width: 750px;
            background: white;
            padding: 40px;
            color: #000000;
        }
    </style>
</head>
<body>

<nav><a href="#" class="logo">Bernard Consulting</a></nav>

<section class="page-header">
    <h1>Flip Analysis Pro</h1>
    <p style="opacity: 0.8;">Institutional-Grade Underwriting</p>
</section>

<div class="container-narrow">
    <div class="calc-card">
        <div class="input-group">
            <label>Property Address</label>
            <input type="text" id="propAddress" placeholder="e.g. 123 Main St">
        </div>
        
        <div class="section-label">1. Revenue & Acquisition</div>
        <div class="input-group">
            <label>After Repair Value (ARV)</label>
            <span class="desc">Estimated value after renovations.</span>
            <input type="number" id="arv" placeholder="0.00">
        </div>
        <div class="input-group">
            <label>Purchase Price</label>
            <input type="number" id="purchase" placeholder="0.00">
        </div>

        <div class="section-label">2. Financing</div>
        <div class="input-group">
            <label>Loan Amount</label>
            <input type="number" id="loanAmt" placeholder="0.00">
        </div>

        <div class="section-label">3. Project Expenses</div>
        <div class="input-group">
            <label>Closing Cost & Due Diligence</label>
            <span class="desc">Lender points, permits, title, legal, appraisal.</span>
            <input type="number" id="closing" placeholder="0.00">
        </div>
        <div class="input-group">
            <label>Reserves</label>
            <span class="desc">Cash for buffer & cost overruns.</span>
            <input type="number" id="reserves" placeholder="0.00">
        </div>
        <div class="input-group">
            <label>Rehab Cost</label>
            <input type="number" id="rehab" placeholder="0.00">
        </div>
        <div class="input-group">
            <label>Holding Cost</label>
            <span class="desc">Insurance, taxes, utilities, interest.</span>
            <input type="number" id="holding" placeholder="0.00">
        </div>
        <div class="input-group">
            <label>Selling Cost</label>
            <span class="desc">Commissions & transfer tax (Paid at closing).</span>
            <input type="number" id="selling" placeholder="0.00">
        </div>

        <div class="btn-container">
            <button class="analyze-btn" onclick="runAnalysis()">Run Analysis</button>
            <button id="pdfBtn" class="pdf-btn" onclick="exportPDF()">Download PDF Report</button>
        </div>

        <div id="result"></div>
    </div>
</div>

<div id="pdf-export-element">
    <div style="border-bottom: 4px solid #00d1b2; padding-bottom: 10px;">
        <h1 style="font-size: 24pt; margin: 0;">Project Underwriting Report</h1>
        <div id="pdf-addr-out" style="font-size: 16pt; margin-top: 10px; font-weight: bold;"></div>
        <div style="font-size: 10pt; color: #555;">Bernard Consulting Services | <span id="pdf-date-out"></span></div>
    </div>

    <div id="pdf-stats-out" style="margin: 30px 0;"></div>

    <div style="background: #f0f4f8; border: 1px solid #0a2540; padding: 20px;">
        <h3 style="margin-top: 0; border-bottom: 1px solid #0a2540;">Upfront Capital Summary</h3>
        <table style="width: 100%; font-size: 12pt; border-collapse: collapse;">
            <tr><td style="padding: 5px 0;">Upfront Project Costs:</td><td id="pdf-cost-out" style="text-align: right; font-weight: bold;"></td></tr>
            <tr><td style="padding: 5px 0;">Total Loan Amount:</td><td id="pdf-loan-out" style="text-align: right; font-weight: bold;"></td></tr>
            <tr style="border-top: 2px solid #0a2540;"><td style="padding: 10px 0; font-size: 14pt; font-weight: bold;">TOTAL UPFRONT CASH:</td><td id="pdf-cash-out" style="text-align: right; font-size: 14pt; font-weight: bold;"></td></tr>
        </table>
    </div>
</div>

<script>
function runAnalysis() {
    const v = (id) => parseFloat(document.getElementById(id).value) || 0;
    
    const arv = v('arv'), purchase = v('purchase'), loan = v('loanAmt'), 
          rehab = v('rehab'), closing = v('closing'), reserves = v('reserves'), 
          holding = v('holding'), selling = v('selling');
    
    const totalProjectCost = purchase + rehab + closing + reserves + holding + selling;
    const upfrontCosts = purchase + rehab + closing + reserves + holding;
    const profit = arv - totalProjectCost;
    const upfrontCash = upfrontCosts - loan;

    const purcRehabPct = arv > 0 ? ((purchase + rehab) / arv) * 100 : 0;
    const totCostPct = arv > 0 ? (totalProjectCost / arv) * 100 : 0;
    const profitPct = arv > 0 ? (profit / arv) * 100 : 0;
    const cocReturn = upfrontCash > 0 ? (profit / upfrontCash) * 100 : 0;
    
    const resHtml = `
        <div style="margin-bottom: 10px; border-bottom: 1px solid #ccc; padding-bottom: 5px;">Purchase + Rehab as % of ARV: <strong>${purcRehabPct.toFixed(1)}%</strong></div>
        <div style="margin-bottom: 10px; border-bottom: 1px solid #ccc; padding-bottom: 5px;">Total Cost as % of ARV: <strong>${totCostPct.toFixed(1)}%</strong></div>
        <div style="margin-bottom: 10px; border-bottom: 1px solid #ccc; padding-bottom: 5px;">Profit as % of ARV: <strong>${profitPct.toFixed(1)}%</strong></div>
        <div style="margin-bottom: 10px; border-bottom: 1px solid #ccc; padding-bottom: 5px;">Upfront Cash Required: <strong>$${upfrontCash.toLocaleString()}</strong></div>
        <div style="margin-bottom: 10px; border-bottom: 1px solid #ccc; padding-bottom: 5px;">Cash-on-Cash Return: <strong>${cocReturn.toFixed(1)}%</strong></div>
        <div style="font-size: 20pt; font-weight: bold; text-align: center; margin-top: 15px;">Net Profit: $${profit.toLocaleString()}</div>
    `;

    document.getElementById('result').style.display = 'block';
    document.getElementById('result').innerHTML = resHtml;
    document.getElementById('pdfBtn').style.display = 'block';

    // Immediate injection into the PDF template fields
    document.getElementById('pdf-addr-out').innerText = document.getElementById('propAddress').value || "Project Analysis";
    document.getElementById('pdf-date-out').innerText = new Date().toLocaleDateString();
    document.getElementById('pdf-stats-out').innerHTML = resHtml;
    document.getElementById('pdf-cost-out').innerText = '$' + upfrontCosts.toLocaleString();
    document.getElementById('pdf-loan-out').innerText = '$' + loan.toLocaleString();
    document.getElementById('pdf-cash-out').innerText = '$' + upfrontCash.toLocaleString();
}

function exportPDF() {
    const element = document.getElementById('pdf-export-element');
    const opt = {
        margin: 0.5,
        filename: 'Underwriting-Report.pdf',
        image: { type: 'jpeg', quality: 0.98 },
        html2canvas: { scale: 2, useCORS: true },
        jsPDF: { unit: 'in', format: 'letter', orientation: 'portrait' }
    };
    html2pdf().set(opt).from(element).save();
}
</script>
</body>
</html>


